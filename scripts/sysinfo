#!/bin/sh
#
# Licensed under GPL v2 or later at your option
# Copyright 2004 by Michiel de Boer <infobash@rebelhomicide.demon.nl>
# Copyright 2006 by Emil Obermayr <nobs@tigress.com>
#
# $Id: sysinfo,v 1.4 2006/01/03 20:22:23 nobs Exp $
#

PORT=$1;
SERVER=$2;
TARGET=$3;

export LC_ALL="C"

HN="$(hostname)"
OSKERN="$(uname -s) $(uname -r)"
CPU=$(awk -F':' '/model name/{printf("%s",$2)} /cpu MHz/{printf(" %d MHz ",$2)}/bogomips/ {printf("%d Bogomips",$2) }' /proc/cpuinfo )
HDD=$(df -l| awk '($1~/dev/){use+=$3/1e6;tot+=$2/1e6}END{print "HD:" int(use) "/" int(tot) "GB"}')
MEM=$(awk '($1=="MemTotal:"){tot=int($2/1e3)}($1=="MemFree:"){free=int($2/1e3)}END{print "RAM:" free "/" tot "MB"}' /proc/meminfo)
PROC="$(($(ps aux | wc -l)-1))"
UPT="$(uptime | sed 's/^.*up *\([^,]*\).*$/\1/g')"

out="sysinfo for $HN: $OSKERN, $CPU, $HDD, $MEM, $PROC proc's, $UPT h up" 

if [ "x$TARGET" == "x" ] ; then         
    dcop $PORT Konversation error "$out"
else
    dcop $PORT Konversation say $SERVER "$TARGET" "$out"
fi
