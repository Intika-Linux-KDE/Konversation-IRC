#!/bin/sh
#
# Licensed under GPL v2 or later at your option
# Copyright 2004 by Michiel de Boer <infobash@rebelhomicide.demon.nl>
# Copyright 2006 by Emil Obermayr <nobs@tigress.com>
#
# this version is stripped down to no-color
#
# get full original version at http://rebelhomicide.demon.nl/scripts/

PORT=$1;
SERVER=$2;
TARGET=$3;

export LC_ALL="C"

HN="$(hostname)"
OSKERN="$(uname -s) $(uname -r)"
KDE="$(kde-config --version | sed -n '2p' | sed 's/://')"

CPU=$(awk -F':' '/model name/{name=$2}
 /cpu MHz/{mhz=int($2)}
 /bogomips/ {bogo=int($2) 
}
END{
 gsub (/ *\(tm\) */, " ", name);
 gsub (/ *Processor */, " ", name);
 gsub (/ *$/, "", name);
 gsub (/^ */, "", name);
 printf "CPU: %s at %d MHz (%d bogomips)", name, mhz, bogo;
}
' /proc/cpuinfo )

HDD=$(df -l| awk '($1~/dev/){
  use+=$3/1e6;
  tot+=$2/1e6
 }
 END{print "HD: " int(use) "/" int(tot) "GB"}')

MEM=$(awk '($1=="MemTotal:"){tot=int($2/1e3)}
 ($1=="MemFree:"){free=int($2/1e3)}
 END{print "RAM: " free "/" tot "MB"}
' /proc/meminfo)

PROC="$(($(ps aux | wc -l)-1))"
UPT="$(uptime | sed 's/^.*up *\([^,]*\).*$/\1/g')"

out="Sysinfo for '$HN': $OSKERN running $KDE, $CPU, $HDD, $MEM, $PROC proc's, ${UPT}h up" 

if [ "x$PORT" == "x" ] ; then
    echo "$out"
else
    if [ "x$TARGET" == "x" ] ; then
	dcop $PORT Konversation error "$out"
    else
	dcop $PORT Konversation say $SERVER "$TARGET" "$out"
    fi
fi
